<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جامعة مكة للتقنية - البوابة الأكاديمية</title>
    
    <!-- Fonts: IBM Plex Sans Arabic -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config for Custom Colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-primary': '#1B8354',
                        'brand-dark': '#14573A',
                        'brand-light': '#B8EACB',
                        'neutral-text': '#1F2A37',
                        'neutral-sub': '#6B7280',
                        'gov-green': '#074D31',
                    },
                    fontFamily: {
                        sans: ['IBM Plex Sans Arabic', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'IBM Plex Sans Arabic', sans-serif;
            background-color: #F9FAFB;
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #1B8354; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #14573A; 
        }
        
        /* Dropdown Transitions */
        .group:hover .group-hover\:block {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col text-right">

    <!-- API Configuration -->
    <script>
        const apiKey = ""; 
    </script>

    <!-- ================= Login Screen ================= -->
    <div id="login-screen" class="min-h-screen flex flex-col items-center justify-center bg-[#F9FAFB] relative overflow-hidden">
        <div class="absolute inset-0 opacity-5 pointer-events-none" style="background-image: radial-gradient(#1B8354 1px, transparent 1px); background-size: 20px 20px;"></div>
        
        <div class="w-full max-w-md bg-white p-8 rounded-[16px] shadow-xl border border-[#D2D6DB] relative z-10">
            <div class="text-center mb-8">
                <div class="bg-brand-primary w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg text-white">
                    <i data-lucide="graduation-cap" class="w-8 h-8"></i>
                </div>
                <h1 class="text-2xl font-bold text-neutral-text">جامعة مكة للتقنية</h1>
                <p class="text-gray-500 mt-2">البوابة الأكاديمية الموحدة</p>
            </div>

            <div class="space-y-6">
                <button onclick="handleLogin()" class="w-full bg-brand-primary text-white py-3.5 px-4 rounded-lg font-bold hover:bg-brand-dark transition-all transform hover:-translate-y-0.5 hover:shadow-lg flex items-center justify-center gap-3 border border-transparent">
                    <img src="https://nafath.sa/assets/images/logo.png" alt="Nafath" class="h-6 w-auto brightness-0 invert" onerror="this.style.display='none'">
                    <span>تسجيل الدخول عبر نفاذ</span>
                </button>
                
                <div class="relative">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500">أو</span>
                    </div>
                </div>

                <form onsubmit="event.preventDefault(); handleLogin();" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">الرقم الجامعي</label>
                        <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-light focus:border-brand-primary outline-none transition-all text-left" dir="ltr" placeholder="442...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">كلمة المرور</label>
                        <input type="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-light focus:border-brand-primary outline-none transition-all text-left" dir="ltr">
                    </div>
                    <button type="submit" class="w-full bg-white text-neutral-text border border-[#D2D6DB] py-2.5 rounded-lg font-medium hover:bg-gray-50 transition-colors">
                        دخول المنسوبين
                    </button>
                </form>
            </div>
            <div class="mt-8 pt-6 border-t border-gray-100 text-center">
                <p class="text-xs text-gray-400">جميع الحقوق محفوظة © جامعة مكة للتقنية 2024</p>
            </div>
        </div>
    </div>

    <!-- ================= Main App ================= -->
    <div id="main-app" class="hidden flex-col min-h-screen">
        
        <!-- Header -->
        <header class="sticky top-0 z-50 shadow-md bg-white">
            <!-- 1. Secondary Nav (Top Strip) -->
            <div class="bg-[#F3F4F6] border-b border-[#E5E7EB] py-2 hidden md:block">
                <div class="container mx-auto px-4 lg:px-[80px] flex items-center justify-between text-[12px] text-[#6B7280]">
                    <!-- Right: Info -->
                    <div class="flex items-center gap-6">
                        <span class="flex items-center gap-1.5 hover:text-brand-primary cursor-default transition-colors">
                            <i data-lucide="sun" class="w-3.5 h-3.5"></i>
                            <span>غائم</span>
                        </span>
                        <span class="w-px h-3 bg-gray-300"></span>
                        <span class="flex items-center gap-1.5 hover:text-brand-primary cursor-default transition-colors">
                            <i data-lucide="calendar" class="w-3.5 h-3.5"></i>
                            <span id="header-date"></span>
                        </span>
                        <span class="w-px h-3 bg-gray-300"></span>
                        <span class="flex items-center gap-1.5 hover:text-brand-primary cursor-default transition-colors">
                            <i data-lucide="clock" class="w-3.5 h-3.5"></i>
                            <span id="header-time"></span>
                        </span>
                    </div>
                    <!-- Left: Settings -->
                    <div class="flex items-center gap-4">
                        <button class="hover:text-brand-primary transition-colors font-medium">عربي</button>
                        <button class="hover:text-brand-primary transition-colors">English</button>
                        <span class="w-px h-3 bg-gray-300"></span>
                        <button class="hover:text-brand-primary transition-colors">سهولة الوصول</button>
                    </div>
                </div>
            </div>

            <!-- 2. Main Header (Nav with Dropdowns) -->
            <div class="bg-white border-b border-[#D2D6DB]">
                <div class="container mx-auto px-4 lg:px-[80px] h-[80px] flex items-center justify-between">
                    
                    <!-- Right: Brand (Saudi Emblem + University) -->
                    <div class="flex items-center h-full gap-4">
                        <!-- Saudi Emblem (Gold/Green) -->
                        <div class="w-10 h-10 flex items-center justify-center">
                            <svg viewBox="0 0 100 100" class="w-full h-full text-[#c5a45e] fill-current">
                                <!-- Abstract Palm and Swords Representation -->
                                <path d="M50 20 C40 30 30 30 20 40 M50 20 C60 30 70 30 80 40 M50 20 V80 M30 70 L70 50 M70 70 L30 50" stroke="currentColor" stroke-width="4" stroke-linecap="round" />
                            </svg>
                        </div>
                        <div class="flex flex-col">
                            <span class="font-bold text-lg leading-tight text-neutral-text">جامعة مكة للتقنية</span>
                            <span class="text-[11px] opacity-80 text-neutral-sub">Makkah University of Technology</span>
                        </div>
                    </div>

                    <!-- Center: Navigation Tabs with Dropdowns -->
                    <nav class="hidden xl:flex items-center h-full flex-1 justify-start mr-8">
                        <div class="flex items-center h-full gap-2" id="desktop-nav">
                            <!-- Injected by JS -->
                        </div>
                    </nav>

                    <!-- Left: Actions (Matching Image: Login - English - Search) -->
                    <div class="flex items-center gap-6">
                        <!-- Search -->
                        <button class="flex items-center gap-2 text-[#384250] hover:text-brand-primary transition-colors group">
                            <i data-lucide="search" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                            <span class="hidden lg:inline text-sm font-medium">البحث</span>
                        </button>

                        <!-- English -->
                        <button class="flex items-center gap-2 text-[#384250] hover:text-brand-primary transition-colors font-medium text-sm">
                            <span>English</span>
                            <i data-lucide="languages" class="w-4 h-4 text-gray-400"></i>
                        </button>

                        <!-- Login -->
                        <button onclick="handleLogout()" class="flex items-center gap-2 text-[#384250] hover:text-[#C53030] transition-colors group">
                            <span class="hidden lg:inline text-sm font-bold">تسجيل الدخول</span>
                            <div class="bg-gray-100 p-2 rounded-full group-hover:bg-red-50 transition-colors">
                                <i data-lucide="user" class="w-5 h-5"></i>
                            </div>
                        </button>

                        <!-- Mobile Menu Toggle -->
                        <button class="xl:hidden p-2 text-[#384250] hover:bg-gray-50 rounded-lg" onclick="toggleMobileMenu()">
                            <i data-lucide="menu" id="mobile-menu-icon" class="w-6 h-6"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden xl:hidden bg-white border-b border-[#D2D6DB] px-4 py-4 space-y-1 animate-fade-in shadow-lg">
                <!-- Mobile links injected by JS -->
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto px-4 lg:px-[80px] py-8 relative">
            <!-- Breadcrumbs -->
            <div class="flex items-center gap-2 text-sm text-gray-500 mb-6">
                <span class="hover:text-brand-primary cursor-pointer">الرئيسية</span>
                <i data-lucide="chevron-left" class="w-3.5 h-3.5"></i>
                <span class="text-brand-primary font-medium" id="breadcrumb-current">لوحة المعلومات</span>
            </div>

            <!-- Content Area -->
            <div id="content-area">
                <!-- Views injected by JS -->
            </div>
        </main>

        <!-- AI Modal -->
        <div id="ai-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4">
            <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeAiModal()"></div>
            <div class="bg-white rounded-[16px] shadow-2xl w-full max-w-lg relative z-10 overflow-hidden flex flex-col max-h-[80vh]">
                <div class="bg-brand-primary p-4 flex items-center justify-between text-white">
                    <div class="flex items-center gap-2">
                        <i data-lucide="sparkles" class="w-5 h-5 text-brand-light"></i>
                        <h3 class="font-bold" id="ai-modal-title">المساعد الذكي</h3>
                    </div>
                    <button onclick="closeAiModal()" class="hover:bg-white/20 p-1 rounded-full transition-colors">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                
                <div class="p-6 overflow-y-auto" id="ai-modal-content">
                    <!-- Content/Loader -->
                </div>

                <div class="p-4 bg-gray-50 border-t border-gray-100 flex justify-end" id="ai-modal-footer">
                    <button onclick="copyAiResponse()" class="px-4 py-2 text-sm text-brand-primary border border-brand-primary rounded-lg hover:bg-brand-primary hover:text-white transition-colors">
                        نسخ النص
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-gov-green text-white pt-12 pb-8">
            <div class="container mx-auto px-4 lg:px-[80px]">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-16 text-right">
                    
                    <!-- Col 4 (Right in RTL): Related Links -->
                    <div>
                        <h3 class="font-bold text-lg mb-6 text-white pb-2 border-b border-[#ffffff33] inline-block min-w-[140px]">روابط هامة</h3>
                        <ul class="space-y-3 text-sm text-gray-200">
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">وزارة التعليم</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">مجلس شؤون الجامعات</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">المكتبة الرقمية السعودية (SDL)</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">رؤية المملكة 2030</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">المنصة الوطنية الموحدة</a></li>
                        </ul>
                    </div>

                    <!-- Col 3: Important Sections -->
                    <div>
                        <h3 class="font-bold text-lg mb-6 text-white pb-2 border-b border-[#ffffff33] inline-block min-w-[140px]">عن الجامعة</h3>
                        <ul class="space-y-3 text-sm text-gray-200">
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">نبذة عن الجامعة</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">الكليات والمعاهد</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">العمادات المساندة</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">المدينة الجامعية</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">البحث العلمي والابتكار</a></li>
                        </ul>
                    </div>

                    <!-- Col 2: Help & Support -->
                    <div>
                        <h3 class="font-bold text-lg mb-6 text-white pb-2 border-b border-[#ffffff33] inline-block min-w-[140px]">الخدمات والدعم</h3>
                        <ul class="space-y-3 text-sm text-gray-200">
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">دليل القبول والتسجيل</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">التقويم الأكاديمي</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">الخدمات الإلكترونية (بوابة منسوبي)</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">الدعم الفني</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">الأسئلة الشائعة</a></li>
                            <li><a href="#" class="hover:text-brand-light hover:underline transition-colors">تقديم بلاغ أو شكوى</a></li>
                        </ul>
                    </div>

                    <!-- Col 1 (Left): Contact & Tools -->
                    <div>
                        <h3 class="font-bold text-lg mb-4 text-white">تواصل معنا</h3>
                        <div class="flex gap-3 mb-8">
                            <a href="#" class="w-10 h-10 bg-[#ffffff1a] rounded flex items-center justify-center hover:bg-[#ffffff33] transition-colors"><i data-lucide="facebook" class="w-5 h-5"></i></a>
                            <a href="#" class="w-10 h-10 bg-[#ffffff1a] rounded flex items-center justify-center hover:bg-[#ffffff33] transition-colors"><i data-lucide="instagram" class="w-5 h-5"></i></a>
                            <a href="#" class="w-10 h-10 bg-[#ffffff1a] rounded flex items-center justify-center hover:bg-[#ffffff33] transition-colors"><i data-lucide="linkedin" class="w-5 h-5"></i></a>
                            <a href="#" class="w-10 h-10 bg-[#ffffff1a] rounded flex items-center justify-center hover:bg-[#ffffff33] transition-colors"><i data-lucide="x" class="w-5 h-5"></i></a>
                        </div>

                        <h3 class="font-bold text-lg mb-4 text-white">أدوات الإتاحة وامكانية الوصول</h3>
                        <div class="flex gap-3 flex-wrap">
                            <button class="w-10 h-10 bg-[#ffffff1a] rounded flex items-center justify-center hover:bg-[#ffffff33] transition-colors" title="تكبير النص"><i data-lucide="zoom-in" class="w-5 h-5"></i></button>
                            <button class="w-10 h-10 bg-[#ffffff1a] rounded flex items-center justify-center hover:bg-[#ffffff33] transition-colors" title="تباين الألوان"><i data-lucide="eye" class="w-5 h-5"></i></button>
                            <button class="flex items-center gap-2 px-3 h-10 bg-[#ffffff1a] rounded hover:bg-[#ffffff33] transition-colors text-sm font-medium">
                                <i data-lucide="ear" class="w-4 h-4"></i>
                                <span>دعم لغة الاشارة الحية</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Footer Bottom: Logo & Copyright -->
                <div class="flex flex-col md:flex-row justify-between items-end mt-12 pt-8 border-t border-[#ffffff1a]">
                    <!-- Vision Logo -->
                    <div class="mb-6 md:mb-0">
                        <svg viewBox="0 0 200 150" class="h-20 w-auto opacity-100">
                            <path fill="#fff" d="M85.5,50 c-5,0 -10,5 -10,12 c0,5 3,10 8,10 c5,0 8,-5 8,-10 c0,-7 -4,-12 -6,-12 M115,50 c-5,0 -10,5 -10,12 c0,5 3,10 8,10 c5,0 8,-5 8,-10 c0,-7 -4,-12 -6,-12 M100,20 c-40,0 -70,30 -70,70 c0,10 5,20 10,25 c5,5 15,5 20,0 c2,-2 2,-5 0,-7 c-10,-10 -15,-20 -15,-30 c0,-30 25,-55 55,-55 c30,0 55,25 55,55 c0,10 -5,20 -15,30 c-2,2 -2,5 0,7 c5,5 15,5 20,0 c5,-5 10,-15 10,-25 c0,-40 -30,-70 -70,-70" />
                            <text x="100" y="110" fill="#fff" fontSize="14" font-family="IBM Plex Sans Arabic" text-anchor="middle" font-weight="bold">رؤية VISION</text>
                            <text x="100" y="128" fill="#fff" fontSize="14" font-family="IBM Plex Sans Arabic" text-anchor="middle" font-weight="bold">2030</text>
                        </svg>
                    </div>
                    
                    <!-- Copyright & Policy Links -->
                    <div class="text-left w-full md:w-auto">
                        <p class="font-bold text-white mb-2 text-left rtl:text-left">جميع الحقوق محفوظة لجامعة مكة للتقنية © 2025</p>
                        <div class="flex gap-4 justify-end text-sm text-gray-300">
                            <a href="#" class="hover:text-white transition-colors">الشروط والأحكام</a>
                            <span>|</span>
                            <a href="#" class="hover:text-white transition-colors">سياسة الخصوصية</a>
                            <span>|</span>
                            <a href="#" class="hover:text-white transition-colors">ميثاق العملاء</a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- ================= Logic Script ================= -->
    <script>
        // --- Mock Data ---
        const STUDENT_DATA = {
            name: "عبدالله بن محمد العتيبي",
            id: "442011589",
            college: "كلية علوم الحاسب والمعلومات",
            major: "هندسة برمجيات",
            gpa: 4.85,
            level: 6,
            status: "منتظم",
            advisor: "د. خالد السالم",
            email: "s442011589@mut.edu.sa"
        };

        const SCHEDULE_DATA = [
            { id: 1, course: "هندسة البرمجيات المتقدمة", code: "SE301", time: "08:00 - 09:50", days: "الأحد - الثلاثاء - الخميس", room: "G-102", type: "محاضرة", absence: 5 },
            { id: 2, course: "نظم قواعد البيانات 2", code: "CS204", time: "10:00 - 11:50", days: "الأثنين - الأربعاء", room: "LAB-3", type: "عملي", absence: 0 },
            { id: 3, course: "أمن المعلومات", code: "IS320", time: "13:00 - 13:50", days: "الأحد - الثلاثاء - الخميس", room: "G-205", type: "محاضرة", absence: 10 },
            { id: 4, course: "الثقافة الإسلامية 3", code: "IC103", time: "14:00 - 14:50", days: "عن بعد", room: "Online", type: "محاضرة", absence: 0 },
        ];

        const TRANSCRIPT_DATA = [
            { semester: "الفصل الدراسي الأول 1445", gpa: 4.90, courses: [
                { name: "برمجة 1", grade: "A+", points: 5.0 },
                { name: "رياضيات متقطعة", grade: "A", points: 4.75 },
                { name: "فيزياء عامة", grade: "B+", points: 4.5 },
            ]},
            { semester: "الفصل الدراسي الثاني 1445", gpa: 4.80, courses: [
                { name: "برمجة 2", grade: "A+", points: 5.0 },
                { name: "تفاضل وتكامل", grade: "A", points: 4.75 },
                { name: "لغة إنجليزية", grade: "A+", points: 5.0 },
            ]}
        ];

        const EXAMS_DATA = [
            { course: "هندسة البرمجيات المتقدمة", date: "1446-05-15", time: "08:00 صباحاً", room: "القاعة الكبرى A" },
            { course: "نظم قواعد البيانات 2", date: "1446-05-18", time: "10:30 صباحاً", room: "معمل 3" },
            { course: "أمن المعلومات", date: "1446-05-22", time: "08:00 صباحاً", room: "قاعة 205" },
        ];

        // --- State Management ---
        let activeTab = 'dashboard';
        let isMobileMenuOpen = false;
        let aiResponseText = '';

        // --- Tabs Config with Submenus (Dropdowns) ---
        const tabs = [
            { id: 'dashboard', label: 'الرئيسية', subItems: [] },
            { 
                id: 'schedule', 
                label: 'الخدمات الأكاديمية', 
                subItems: [
                    { id: 'schedule', label: 'الجدول الدراسي' },
                    { id: 'transcript', label: 'السجل الأكاديمي' },
                    { id: 'exams', label: 'الاختبارات' }
                ] 
            },
            { 
                id: 'admission', 
                label: 'القبول والتسجيل', 
                subItems: [
                    { id: '#', label: 'طلب قبول' },
                    { id: '#', label: 'التقويم الجامعي' }
                ] 
            },
            { 
                id: 'students', 
                label: 'شؤون الطلاب', 
                subItems: [
                    { id: '#', label: 'الأندية الطلابية' },
                    { id: '#', label: 'المكافآت' }
                ] 
            },
            { 
                id: 'library', 
                label: 'المكتبة الرقمية', 
                subItems: [
                    { id: '#', label: 'بحث في المصادر' },
                    { id: '#', label: 'حجز قاعات المذاكرة' }
                ] 
            },
        ];

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            startClock();
            document.getElementById('user-name-display').innerText = STUDENT_DATA.name.split(' ')[0];
            renderNavigation();
            renderContent();
        });

        // --- Functions ---

        function handleLogin() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('main-app').classList.add('flex');
            switchTab('dashboard');
        }

        function handleLogout() {
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('main-app').classList.remove('flex');
            document.getElementById('login-screen').classList.remove('hidden');
        }

        function startClock() {
            const update = () => {
                const now = new Date();
                const gregorian = now.toLocaleDateString('ar-SA', { day: 'numeric', month: 'long', year: 'numeric' });
                const time = now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
                
                const dateEl = document.getElementById('header-date');
                const timeEl = document.getElementById('header-time');
                if(dateEl) dateEl.innerText = gregorian;
                if(timeEl) timeEl.innerText = time;
            };
            update();
            setInterval(update, 60000);
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const icon = document.getElementById('mobile-menu-icon');
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                icon.setAttribute('data-lucide', 'x');
            } else {
                menu.classList.add('hidden');
                icon.setAttribute('data-lucide', 'menu');
            }
            lucide.createIcons();
        }

        function switchTab(tabId) {
            if (tabId === '#') return;

            activeTab = tabId;
            isMobileMenuOpen = false;
            document.getElementById('mobile-menu').classList.add('hidden');
            document.getElementById('mobile-menu-icon').setAttribute('data-lucide', 'menu');
            
            const titles = {
                dashboard: 'لوحة المعلومات',
                schedule: 'الجدول الدراسي',
                transcript: 'السجل الأكاديمي',
                exams: 'الاختبارات',
            };
            document.getElementById('breadcrumb-current').innerText = titles[tabId] || titles.dashboard;

            renderNavigation(); 
            renderContent();
            lucide.createIcons();
        }

        function renderNavigation() {
            const navContainer = document.getElementById('desktop-nav');
            let html = '';
            
            tabs.forEach(tab => {
                const isSelfActive = activeTab === tab.id;
                const isChildActive = tab.subItems.some(sub => sub.id === activeTab);
                const isActive = isSelfActive || isChildActive;

                // --- STYLING LOGIC BASED ON IMAGES ---
                
                // Base Classes
                // rounded-t-lg for top corners
                // relative for positioning bottom bar
                const baseClasses = "group relative flex items-center justify-center gap-1 px-5 h-[50px] mt-[30px] text-[15px] font-medium transition-all duration-200 cursor-pointer rounded-t-lg";
                
                // Active State (Green Box)
                // bg-brand-primary, text-white
                // Bottom bar: lighter green, rounded pill shape, small padding from sides
                const activeClasses = isActive 
                    ? 'bg-brand-primary text-white shadow-sm' 
                    : 'text-[#384250] hover:bg-[#F3F4F6] hover:text-[#1F2A37]';
                
                // Bottom Bar HTML (Only for Active/Hover)
                // For Active: Light Green pill
                // For Hover: Gray pill
                let bottomBar = '';
                if (isActive) {
                    bottomBar = `<div class="absolute bottom-1 left-2 right-2 h-1.5 bg-[#5CBF8E] rounded-full"></div>`;
                } else {
                    // Hover effect bar (Gray) - visible on group hover
                    bottomBar = `<div class="absolute bottom-1 left-2 right-2 h-1.5 bg-[#D1D5DB] rounded-full hidden group-hover:block"></div>`;
                }

                const chevronColor = isActive ? 'text-white/80 group-hover:text-white' : 'text-gray-400 group-hover:text-gray-600';
                
                const chevron = tab.subItems.length > 0 
                    ? `<i data-lucide="chevron-down" class="w-3.5 h-3.5 ${chevronColor} transition-transform group-hover:rotate-180"></i>` 
                    : '';

                let dropdownHtml = '';
                if (tab.subItems.length > 0) {
                    const subLinks = tab.subItems.map(sub => `
                        <a onclick="switchTab('${sub.id}')" class="block px-4 py-3 text-sm text-gray-700 hover:bg-brand-light/20 hover:text-brand-primary cursor-pointer transition-colors ${activeTab === sub.id ? 'bg-brand-light/10 text-brand-primary font-bold' : ''}">
                            ${sub.label}
                        </a>
                    `).join('');
                    
                    dropdownHtml = `
                        <div class="absolute top-full right-0 w-56 bg-white border border-gray-100 shadow-xl rounded-b-lg hidden group-hover:block z-50 pt-2 animate-fade-in text-right">
                            <div class="bg-white rounded-b-lg overflow-hidden">
                                ${subLinks}
                            </div>
                        </div>
                    `;
                }
                
                const clickAction = tab.subItems.length === 0 ? `onclick="switchTab('${tab.id}')"` : '';

                html += `
                    <div class="${baseClasses} ${activeClasses}" ${clickAction}>
                        ${tab.label}
                        ${chevron}
                        ${bottomBar}
                        ${dropdownHtml}
                    </div>
                `;
            });
            navContainer.innerHTML = html;

            // Mobile Nav
            const mobileContainer = document.getElementById('mobile-menu');
            let mobileHtml = '';
            
            tabs.forEach(tab => {
                if (tab.subItems.length === 0) {
                    mobileHtml += `
                        <button onclick="switchTab('${tab.id}')" class="w-full text-right px-4 py-3 hover:bg-gray-50 rounded-lg text-[#384250] font-medium">
                            ${tab.label}
                        </button>
                    `;
                } else {
                    const subLinks = tab.subItems.map(sub => `
                        <button onclick="switchTab('${sub.id}')" class="w-full text-right px-8 py-2 text-sm text-gray-600 hover:text-brand-primary">
                            - ${sub.label}
                        </button>
                    `).join('');
                    
                    mobileHtml += `
                        <div class="space-y-1">
                            <div class="px-4 py-3 font-medium text-[#384250] bg-gray-50 rounded-lg">${tab.label}</div>
                            ${subLinks}
                        </div>
                    `;
                }
            });
            
            mobileHtml += `
                <div class="border-t border-gray-100 my-2 pt-2">
                    <button onclick="handleLogout()" class="w-full text-right px-4 py-3 text-red-600 font-medium flex items-center gap-2">
                        <i data-lucide="log-out" class="w-4 h-4"></i> تسجيل الخروج
                    </button>
                </div>
            `;
            mobileContainer.innerHTML = mobileHtml;
            
            lucide.createIcons();
        }

        function renderContent() {
            const container = document.getElementById('content-area');
            container.innerHTML = ''; // Clear previous

            if (activeTab === 'dashboard') {
                container.innerHTML = renderDashboard();
            } else if (activeTab === 'schedule') {
                container.innerHTML = renderSchedule();
            } else if (activeTab === 'transcript') {
                container.innerHTML = renderTranscript();
            } else if (activeTab === 'exams') {
                container.innerHTML = renderExams();
            } else {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-20 text-center animate-fade-in">
                        <div class="bg-gray-100 p-6 rounded-full mb-4">
                            <i data-lucide="construction" class="w-12 h-12 text-gray-400"></i>
                        </div>
                        <h2 class="text-xl font-bold text-gray-700">صفحة قيد التطوير</h2>
                        <p class="text-gray-500 mt-2">عذراً، هذه الخدمة غير متاحة حالياً في النسخة التجريبية.</p>
                        <button onclick="switchTab('dashboard')" class="mt-6 px-6 py-2 bg-brand-primary text-white rounded-lg hover:bg-brand-dark transition-colors">
                            العودة للرئيسية
                        </button>
                    </div>`;
            }
            lucide.createIcons();
        }

        // --- View Renderers ---

        function renderDashboard() {
            // Schedule Items HTML
            const scheduleItems = SCHEDULE_DATA.slice(0, 2).map(item => `
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-100 hover:bg-brand-light/20 transition-colors">
                    <div>
                        <p class="font-bold text-[#1F2A37]">${item.course}</p>
                        <div class="flex items-center gap-4 text-sm text-gray-500 mt-1">
                            <span class="flex items-center gap-1"><i data-lucide="clock" class="w-3.5 h-3.5"></i> ${item.time}</span>
                            <span class="flex items-center gap-1"><i data-lucide="map-pin" class="w-3.5 h-3.5"></i> ${item.room}</span>
                        </div>
                    </div>
                    <span class="px-3 py-1 bg-brand-primary/10 text-brand-primary rounded-full text-xs font-bold">${item.type}</span>
                </div>
            `).join('');

            return `
                <div class="space-y-8 animate-fade-in">
                    <!-- Welcome Banner -->
                    <div class="bg-gradient-to-l from-brand-primary to-brand-dark rounded-[16px] p-8 text-white shadow-lg relative overflow-hidden">
                        <div class="relative z-10">
                            <h1 class="text-3xl font-bold mb-2">مرحباً بك، ${STUDENT_DATA.name}</h1>
                            <p class="opacity-90">نتمنى لك فصلاً دراسياً مليئاً بالإنجازات في جامعة مكة للتقنية.</p>
                            <div class="mt-6 flex flex-wrap gap-4">
                                <div class="bg-white/20 backdrop-blur-md px-4 py-2 rounded-lg text-sm">الرقم الجامعي: ${STUDENT_DATA.id}</div>
                                <div class="bg-white/20 backdrop-blur-md px-4 py-2 rounded-lg text-sm">${STUDENT_DATA.college}</div>
                            </div>
                        </div>
                        <div class="absolute -left-10 -bottom-20 w-64 h-64 bg-white/5 rounded-full blur-3xl"></div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        ${renderStatCard('المعدل التراكمي', STUDENT_DATA.gpa, 'award', 'bg-brand-primary text-brand-primary')}
                        ${renderStatCard('الساعات المكتسبة', '86', 'book-open', 'bg-blue-600 text-blue-600')}
                        ${renderStatCard('المستوى الدراسي', STUDENT_DATA.level, 'graduation-cap', 'bg-purple-600 text-purple-600')}
                        ${renderStatCard('التنبيهات الأكاديمية', '0', 'alert-circle', 'bg-green-600 text-green-600')}
                    </div>

                    <!-- Quick Info -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Today Schedule -->
                        <div class="bg-white rounded-[16px] border border-[#D2D6DB] p-6 shadow-sm hover:shadow-md transition-shadow lg:col-span-2">
                            <h3 class="font-bold text-lg mb-4 text-[#1F2A37] flex items-center gap-2">
                                <i data-lucide="calendar" class="w-5 h-5 text-brand-primary"></i> محاضرات اليوم
                            </h3>
                            <div class="space-y-4">${scheduleItems}</div>
                        </div>

                        <!-- Advisor -->
                        <div class="bg-white rounded-[16px] border border-[#D2D6DB] p-6 shadow-sm hover:shadow-md transition-shadow">
                            <h3 class="font-bold text-lg mb-4 text-[#1F2A37]">المرشد الأكاديمي</h3>
                            <div class="text-center py-4">
                                <div class="w-20 h-20 bg-gray-200 rounded-full mx-auto mb-3 flex items-center justify-center text-2xl text-gray-400">
                                    <i data-lucide="user" class="w-10 h-10"></i>
                                </div>
                                <p class="font-bold text-[#1F2A37]">${STUDENT_DATA.advisor}</p>
                                <p class="text-sm text-gray-500 mb-4">قسم هندسة البرمجيات</p>
                                <div class="grid gap-2">
                                    <button class="w-full py-2 border border-brand-primary text-brand-primary rounded-lg hover:bg-brand-primary hover:text-white transition-colors text-sm font-medium">حجز موعد</button>
                                    <button onclick="handleDraftEmail()" class="w-full py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:shadow-lg transition-all text-sm font-medium flex items-center justify-center gap-2">
                                        <i data-lucide="sparkles" class="w-4 h-4"></i> صياغة بريد ذكي
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSchedule() {
            const cards = SCHEDULE_DATA.map(item => {
                const absenceColor = item.absence > 15 ? 'bg-red-500' : 'bg-brand-primary';
                const absenceText = item.absence > 15 ? 'text-red-600' : 'text-brand-primary';
                const warning = item.absence >= 25 ? 'أنت محروم في هذه المادة' : 'متبقي 20% على الحرمان';
                
                return `
                <div class="bg-white rounded-[16px] border border-[#D2D6DB] p-6 shadow-sm hover:shadow-md hover:-translate-y-1 hover:border-brand-primary transition-all flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded border border-gray-200">${item.code}</span>
                            <h3 class="font-bold text-lg text-[#1F2A37]">${item.course}</h3>
                        </div>
                        <div class="flex flex-wrap gap-4 text-sm text-gray-600 mb-3">
                            <span class="flex items-center gap-1"><i data-lucide="calendar" class="w-4 h-4 text-brand-primary"></i> ${item.days}</span>
                            <span class="flex items-center gap-1"><i data-lucide="clock" class="w-4 h-4 text-brand-primary"></i> ${item.time}</span>
                            <span class="flex items-center gap-1"><i data-lucide="map-pin" class="w-4 h-4 text-brand-primary"></i> ${item.room}</span>
                        </div>
                        <button onclick="handleCourseInsight('${item.course}')" class="text-xs font-medium text-purple-600 bg-purple-50 px-3 py-1.5 rounded-md hover:bg-purple-100 transition-colors flex items-center gap-1 w-fit">
                            <i data-lucide="sparkles" class="w-3 h-3"></i> نبذة عن المادة
                        </button>
                    </div>
                    
                    <div class="w-full md:w-64 border-t md:border-t-0 md:border-r md:pr-6 pt-4 md:pt-0 border-gray-100">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-sm font-medium text-gray-600">نسبة الغياب</span>
                            <span class="text-sm font-bold ${absenceText}">${item.absence}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="h-2.5 rounded-full ${absenceColor}" style="width: ${item.absence}%"></div>
                        </div>
                        <p class="text-xs text-gray-400 mt-1">${warning}</p>
                    </div>
                </div>
                `;
            }).join('');

            return `
                <div class="animate-fade-in">
                    <div class="mb-8 border-r-4 border-brand-primary pr-4">
                        <h2 class="text-2xl font-bold text-neutral-800">الجدول الدراسي</h2>
                        <p class="text-neutral-500 mt-1">الفصل الدراسي الثاني 1445</p>
                    </div>
                    <div class="grid gap-6">${cards}</div>
                </div>
            `;
        }

        function renderTranscript() {
            const semesters = TRANSCRIPT_DATA.map((sem, idx) => {
                const rows = sem.courses.map(course => `
                    <tr class="hover:bg-gray-50">
                        <td class="p-4 text-[#1F2A37] font-medium">${course.name}</td>
                        <td class="p-4"><span class="font-bold ${course.grade.includes('A') ? 'text-brand-primary' : 'text-gray-700'}">${course.grade}</span></td>
                        <td class="p-4 text-gray-600">${course.points}</td>
                    </tr>
                `).join('');

                return `
                <div class="bg-white rounded-[16px] border border-[#D2D6DB] overflow-hidden mb-8">
                    <div class="bg-gray-50 p-4 border-b border-[#D2D6DB] flex justify-between items-center">
                        <h3 class="font-bold text-[#1F2A37]">${sem.semester}</h3>
                        <span class="px-3 py-1 bg-brand-light text-[#074D31] rounded-full text-sm font-bold">المعدل الفصلي: ${sem.gpa}</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-right">
                            <thead class="bg-white border-b border-[#D2D6DB]">
                                <tr>
                                    <th class="p-4 text-sm font-bold text-gray-500">المقرر</th>
                                    <th class="p-4 text-sm font-bold text-gray-500">التقدير</th>
                                    <th class="p-4 text-sm font-bold text-gray-500">النقاط</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-[#D2D6DB]">${rows}</tbody>
                        </table>
                    </div>
                </div>
                `;
            }).join('');

            return `
                <div class="animate-fade-in">
                    <div class="mb-8 border-r-4 border-brand-primary pr-4">
                        <h2 class="text-2xl font-bold text-neutral-800">السجل الأكاديمي</h2>
                        <p class="text-neutral-500 mt-1">جميع الفصول الدراسية</p>
                    </div>
                    ${semesters}
                </div>
            `;
        }

        function renderExams() {
            const cards = EXAMS_DATA.map(exam => {
                const [year, month, day] = exam.date.split('-');
                return `
                <div class="bg-white rounded-[16px] border border-[#D2D6DB] p-6 shadow-sm hover:shadow-md flex flex-col md:flex-row items-center justify-between">
                    <div class="flex items-center gap-4 mb-4 md:mb-0 w-full md:w-auto">
                        <div class="bg-brand-primary/10 p-4 rounded-xl flex flex-col items-center justify-center min-w-[80px]">
                            <span class="text-sm font-bold text-brand-primary">${month} / ${day}</span>
                            <span class="text-xs text-gray-500">${year}</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg text-[#1F2A37]">${exam.course}</h3>
                            <p class="text-sm text-gray-500">اختبار نهائي - حضوري</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-6 w-full md:w-auto border-t md:border-t-0 md:border-r border-gray-100 pt-4 md:pt-0 md:pr-6 justify-between md:justify-end">
                        <div class="flex flex-col items-start md:items-end">
                            <span class="text-xs text-gray-400 mb-1">الوقت</span>
                            <span class="font-bold text-[#1F2A37] flex items-center gap-2"><i data-lucide="clock" class="w-4 h-4 text-brand-primary"></i> ${exam.time}</span>
                        </div>
                        <div class="flex flex-col items-start md:items-end">
                            <span class="text-xs text-gray-400 mb-1">المكان</span>
                            <span class="font-bold text-[#1F2A37] flex items-center gap-2"><i data-lucide="map-pin" class="w-4 h-4 text-brand-primary"></i> ${exam.room}</span>
                        </div>
                    </div>
                </div>
                `;
            }).join('');

            return `
                <div class="animate-fade-in">
                    <div class="mb-8 border-r-4 border-brand-primary pr-4">
                        <h2 class="text-2xl font-bold text-neutral-800">جدول الاختبارات النهائية</h2>
                        <p class="text-neutral-500 mt-1">الفصل الدراسي الحالي</p>
                    </div>
                    <div class="bg-orange-50 border-r-4 border-orange-400 p-4 rounded-md mb-6 flex items-start gap-3">
                        <i data-lucide="alert-circle" class="text-orange-500 mt-1 w-5 h-5"></i>
                        <div>
                            <p class="font-bold text-orange-800">تنبيه هام</p>
                            <p class="text-sm text-orange-700">يرجى الحضور قبل موعد الاختبار بـ 15 دقيقة وإحضار البطاقة الجامعية. يمنع دخول الجوالات.</p>
                        </div>
                    </div>
                    <div class="grid gap-4">${cards}</div>
                </div>
            `;
        }

        // --- Helper: Render Stat Card ---
        function renderStatCard(label, value, iconName, colorClasses) {
            // colorClasses e.g., 'bg-brand-primary text-brand-primary'
            // We need to parse bg and text colors for the icon container
            const [bgClass, textClass] = colorClasses.split(' ');
            
            return `
            <div class="bg-white rounded-[16px] border border-[#D2D6DB] p-6 shadow-sm hover:shadow-md hover:-translate-y-1 hover:border-brand-primary transition-all flex items-center justify-between">
                <div>
                    <p class="text-neutral-500 text-sm mb-1">${label}</p>
                    <p class="text-2xl font-bold text-neutral-800">${value}</p>
                </div>
                <div class="p-3 rounded-full bg-opacity-10 ${bgClass.replace('bg-', 'bg-')}">
                    <i data-lucide="${iconName}" class="w-6 h-6 ${textClass}"></i>
                </div>
            </div>
            `;
        }

        // --- AI Logic ---

        async function handleDraftEmail() {
            const prompt = `
                قم بصياغة رسالة بريد إلكتروني رسمية ومهذبة باللغة العربية.
                المرسل: الطالب ${STUDENT_DATA.name} (الرقم الجامعي: ${STUDENT_DATA.id})
                المستلم: المرشد الأكاديمي ${STUDENT_DATA.advisor}
                الموضوع: طلب موعد استشارة أكاديمية لمناقشة الخطة الدراسية للفصل القادم.
                النبرة: رسمية، محترفة، وتناسب البيئة الجامعية السعودية.
                تأكد من ترك مكان للتاريخ والتوقيع.
            `;
            openAiModal("صياغة بريد للمرشد");
            await callGemini(prompt);
        }

        async function handleCourseInsight(courseName) {
            const prompt = `
                أنت مساعد أكاديمي ذكي.
                المقرر: ${courseName}
                المهمة: قدم نبذة مختصرة جداً (لا تتجاوز 4 أسطر) عن محتوى هذا المقرر الجامعي، ثم اذكر 3 مواضيع رئيسية (كنقاط) يتم تدريسها عادة في مثل هذا المقرر.
                اللغة: العربية.
            `;
            openAiModal(`نبذة عن ${courseName}`);
            await callGemini(prompt);
        }

        function openAiModal(title) {
            document.getElementById('ai-modal').classList.remove('hidden');
            document.getElementById('ai-modal-title').innerText = title;
            document.getElementById('ai-modal-footer').classList.add('hidden');
            
            // Show Loader
            document.getElementById('ai-modal-content').innerHTML = `
                <div class="flex flex-col items-center justify-center py-8 text-brand-primary">
                    <i data-lucide="loader-2" class="animate-spin mb-3 w-10 h-10"></i>
                    <p class="font-medium animate-pulse">جاري استدعاء الذكاء الاصطناعي...</p>
                </div>
            `;
            lucide.createIcons();
        }

        function closeAiModal() {
            document.getElementById('ai-modal').classList.add('hidden');
        }

        async function callGemini(prompt) {
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }),
                    }
                );
                
                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                aiResponseText = text;
                
                // Show Result
                document.getElementById('ai-modal-content').innerHTML = `
                    <div class="prose prose-sm max-w-none text-right">
                        <p class="whitespace-pre-wrap leading-relaxed text-[#1F2A37]">${text}</p>
                    </div>
                `;
                document.getElementById('ai-modal-footer').classList.remove('hidden');

            } catch (error) {
                console.error(error);
                document.getElementById('ai-modal-content').innerHTML = `
                    <p class="text-red-500 text-center">عذراً، حدث خطأ أثناء الاتصال بالمساعد الذكي. يرجى المحاولة لاحقاً.</p>
                `;
            }
        }

        function copyAiResponse() {
            navigator.clipboard.writeText(aiResponseText);
            alert("تم نسخ النص!");
        }

    </script>
</body>
</html>
